<!--Author: Amulya Mohan Kolakaluri -->
<!-- G#: G01461327 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS Department Survey</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f2f2f2; /* Light gray background */
            font-family: Arial, sans-serif;
        }

        h1 {
            color: #006633; /* GMU Green */
            border: 5px solid #006633;
            text-align: center;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 3px 3px 13px rgba(37, 67, 52, 0.1);
        }

        .form-container {
            background-color: rgba(53, 168, 57, 0.421);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 3px 3px 13px rgba(0, 0, 0, 0.1);
        }

        .required::after {
            content: "*";
            color: red;
        }

        .custom-submit {
            background-color: #006633; /* GMU Green */
            color: white;
        }

        .custom-submit:hover {
            background-color: #004d00; /* Darker GMU Green */
        }
         /* Greeting Section Styles */
         #greeting {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            font-size: 1.5rem;
            color: #006633; /* GMU Green */
            border: 2px solid #006633;
            border-radius: 10px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
            background-color: #e9f5ea;
        }

        #greeting a {
            color: #004d00; /* Darker GMU Green */
            text-decoration: none;
            font-weight: bold;
        }

        #greeting a:hover {
            text-decoration: underline;
        }

        .invalid-zip {
            color: red;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div id="greeting" class="mt-4"></div>
     <!-- Heading -->
    <div class="container mt-4">
        <h1>CS Department Survey</h1>
    </div>

    <!-- Survey Form -->
    <div class="container form-container mt-4">
        <form id="surveyForm">
            <!-- Name -->
            <div class="mb-3">
                <label for="name" class="form-label required">Name</label>
                <input type="text" class="form-control" id="name" placeholder="Enter your Name" required>
            </div>

            <!-- Address -->
            <div class="row">
                <div class="col-md-4">
                    <label for="zip" class="form-label required">ZIP</label>
                    <input type="text" class="form-control" id="zip" placeholder="ZIP Code" required>
                    <span id="invalid-zip" class="invalid-zip"></span>
                </div>
                <div class="col-md-4">
                    <label for="city" class="form-label required">City</label>
                    <input type="text" class="form-control" id="city" readonly>
                </div>
                <div class="col-md-4">
                    <label for="state" class="form-label required">State</label>
                    <input type="text" class="form-control" id="state" readonly>
                </div>              
            </div>
            <div class="mb-3">
                <label for="address" class="form-label required">Address</label>
                <input type="text" class="form-control" id="address" placeholder="Enter your Address" required>
            </div>
           
            <!-- Contact Information -->
            <div class="row mt-3">
                <div class="col-md-6">
                    <label for="telephone" class="form-label required">Telephone</label>
                    <input type="tel" class="form-control" id="telephone" placeholder="123-456-7890" required>
                </div>
                <div class="col-md-6">
                    <label for="email" class="form-label required">E-mail</label>
                    <input type="email" class="form-control" id="email" placeholder="example@example.com" required>
                </div>
            </div>
             <!-- Data Input Field -->
             <div class="mb-3">
                <label for="data" class="form-label required">Data (10 numbers, 1-100)</label>
                <input type="text" class="form-control" id="data" placeholder="Enter 10 numbers separated by commas" required onblur="calculateAverageAndMax()">
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="average" class="form-label">Average</label>
                    <input type="text" class="form-control" id="average" placeholder="Average" readonly>
                </div>
                <div class="col-md-6">
                    <label for="maximum" class="form-label">Maximum</label>
                    <input type="text" class="form-control" id="maximum" placeholder="Maximum" readonly>
                </div>
            </div>

            <!-- Survey Date -->
            <div class="row mt-3">
                <div class="col-md-6">
                    <label for="date" class="form-label required">Survey Date</label>
                    <input type="date" class="form-control" id="date" required>
                </div>
            </div>

            <!-- Checkboxes for Feedback -->
            <div class="mt-4">
                <label class="form-label">What did you like most about the campus?</label>
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="students">
                    <label for="students" class="form-check-label">Students</label>
                </div>
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="location">
                    <label for="location" class="form-check-label">Location</label>
                </div>
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="campus">
                    <label for="campus" class="form-check-label">Campus</label>
                </div>
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="atmosphere">
                    <label for="atmosphere" class="form-check-label">Atmosphere</label>
                </div>
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="dorms">
                    <label for="dorms" class="form-check-label">Dorm Rooms</label>
                </div>
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="sports">
                    <label for="sports" class="form-check-label">Sports</label>
                </div>
            </div>

            <!-- Radio Buttons for Interest Source -->
            <div class="mt-4">
                <label class="form-label">How did you become interested in the university?</label>
                <div class="form-check">
                    <input type="radio" class="form-check-input" name="interest" id="friends" required>
                    <label for="friends" class="form-check-label">Friends</label>
                </div>
                <div class="form-check">
                    <input type="radio" class="form-check-input" name="interest" id="television">
                    <label for="television" class="form-check-label">Television</label>
                </div>
                <div class="form-check">
                    <input type="radio" class="form-check-input" name="interest" id="internet">
                    <label for="internet" class="form-check-label">Internet</label>
                </div>
            </div>

             <!-- Text Area for Additional Comments -->
             <div class="mt-4">
                <label for="comments" class="form-label">Additional Comments</label>
                <textarea class="form-control" id="comments" rows="4" placeholder="Questions? Comments? Concerns? Let us know!"></textarea>
            </div>

            <!-- Datalist for High-School Graduation Month -->
            <div class="mt-4">
                <label for="grad-month" class="form-label required">High School Graduation Month</label>
                <input list="months" id="grad-month" class="form-control" placeholder="Select month" required>
                <datalist id="months">
                    <option value="January">
                    <option value="February">
                    <option value="March">
                    <option value="April">
                    <option value="May">
                    <option value="June">
                    <option value="July">
                    <option value="August">
                    <option value="September">
                    <option value="October">
                    <option value="November">
                    <option value="December">
                </datalist>
                <input type="text" class="form-control mt-2" placeholder="Year" required>
            </div>

            <!-- Dropdown for Likelihood of Recommending the University -->
            <div class="mt-4">
                <label for="recommend" class="form-label required">How likely are you to recommend this university?</label>
                <select class="form-select" id="recommend" required>
                    <option value="">Select</option>
                    <option value="Very Likely">Very Likely</option>
                    <option value="Likely">Likely</option>
                    <option value="Unlikely">Unlikely</option>
                    <option value="Very Unlikely">Very Unlikely</option>
                </select>
            </div>

            <!-- Buttons for Submit and Reset -->
            <div class="mt-4">
                <button type="submit" class="btn custom-submit">Submit</button>
                <button type="reset" class="btn btn-secondary">Reset</button>
            </div>
        </form>
    </div>

    <!-- JavaScript for Form Validation and Functionality -->
    
         <!-- Bootstrap JS (Optional) -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    <script>
        // Function to get a cookie by name
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null; // Return null if cookie not found
        }

        // Function to set a cookie with an expiration
        function setCookie(name, value, days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = "expires=" + date.toUTCString();
            document.cookie = `${name}=${value}; ${expires}; path=/`;
        }

        // Function to prompt for the user's name and set the cookie
        function promptForName() {
            const name = prompt("Please enter your name:");
            if (name) {
                setCookie("userName", name, 7); // Set cookie with 7-day expiration
                location.reload(); // Reload the page to show the greeting
            }
        }

        // Function to display the greeting based on the time of day
        function greetUser() {
            const userName = getCookie("userName");
            const greetingElement = document.getElementById("greeting");

            const currentHour = new Date().getHours();
            let greeting;
            if (currentHour < 12) {
                greeting = "Good Morning";
            } else if (currentHour < 18) {
                greeting = "Good Afternoon";
            } else {
                greeting = "Good Evening";
            }

            if (userName) {
                // Display the greeting with the user’s name
                greetingElement.innerHTML = `${greeting}, ${userName}! Welcome to SWE642 Survey.
                                             <a href="#" onclick="promptForName()">Not you?</a>`;
            } else {
                // Prompt for name only if no cookie is set
                promptForName();
            }
        }

        // Run the greetUser function on page load
        document.addEventListener("DOMContentLoaded", greetUser);

        // Function to calculate average and maximum of 10 numbers
        function calculateAverageAndMax() {
            var dataInput = document.getElementById('data').value;
            var numbers = dataInput.split(',').map(Number);

            if (numbers.length === 10 && numbers.every(num => num >= 1 && num <= 100)) {
                var total = numbers.reduce((acc, num) => acc + num, 0);
                var average = total / 10;
                var maximum = Math.max(...numbers);

                document.getElementById('average').value = average.toFixed(2);
                document.getElementById('maximum').value = maximum;
            } else {
                alert('Please enter exactly 10 numbers between 1 and 100, separated by commas.');
                document.getElementById('data').focus();
            }
        }


         // Fetch City and State based on ZIP code
         function fetchCityState() {
            const zipInput = document.getElementById("zip");
            const cityInput = document.getElementById("city");
            const stateInput = document.getElementById("state");
            const invalidZipMessage = document.getElementById("invalid-zip");

            zipInput.addEventListener("blur", function () {
                const zipCode = zipInput.value.trim();
                if (/^\d{5}$/.test(zipCode)) {
                    const apiUrl = `https://api.zippopotam.us/us/${zipCode}`;
                    fetch(apiUrl)
                        .then(response => {
                            if (!response.ok) throw new Error('Invalid ZIP code');
                            return response.json();
                        })
                        .then(data => {
                            const place = data.places[0];
                            cityInput.value = place["place name"];
                            stateInput.value = place["state abbreviation"];
                            invalidZipMessage.innerText = '';
                        })
                        .catch(error => {
                            console.error("Error fetching city and state:", error);
                            cityInput.value = '';
                            stateInput.value = '';
                            invalidZipMessage.innerText = 'Invalid ZIP Code';
                        });
                } else {
                    cityInput.value = '';
                    stateInput.value = '';
                    invalidZipMessage.innerText = 'Invalid ZIP Code';
                }
            });
        }

        fetchCityState();
        // Form submission validation
        document.getElementById("surveyForm").addEventListener("submit", function (event) {
            event.preventDefault(); // Prevent the form from submitting

            // Collect form values
            const name = document.getElementById("name").value.trim();
            const address = document.getElementById("address").value.trim();
            const telephone = document.getElementById("telephone").value.trim();
            const email = document.getElementById("email").value.trim();
            const likes = document.querySelectorAll('input[type="checkbox"]:checked');
            const interest = document.querySelector('input[name="interest"]:checked');
            let errors = [];

            // Validate Name: Only alphabets
            if (!/^[a-zA-Z\s]+$/.test(name)) {
                errors.push("Name must contain only alphabets.");
                document.getElementById("name").value = ""; // Clear error field
            }

            // Validate Address: Alphanumeric and appropriate characters
            if (!/^[a-zA-Z0-9\s.,-]+$/.test(address)) {
                errors.push("Address can only contain alphanumeric characters, spaces, and symbols like ., -.");
                document.getElementById("address").value = ""; // Clear error field
            }

            // Validate that at least two checkboxes are checked
            if (likes.length < 2) {
                errors.push("Please select at least two options about what you liked most about the campus.");
            }

            // Validate radio button selection
            if (!interest) {
                errors.push("Please select an option for how you became interested in the university.");
            }

            // Validate Email format
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                errors.push("Please enter a valid email address.");
                document.getElementById("email").value = ""; // Clear error field
            }

            // Show consolidated error message
            if (errors.length > 0) {
                alert("Please correct the following errors:\n- " + errors.join("\n- "));
            } else {
                // If no errors, submit the form
                alert("Form submitted successfully!"); // Add a message for successful submission
                this.submit();
            }
        });

        // Reset button functionality
        document.querySelector("button[type='reset']").addEventListener("click", function () {
            // Clear all input fields
            document.getElementById("name").value = "";
            document.getElementById("address").value = "";
            document.getElementById("telephone").value = "";
            document.getElementById("email").value = "";
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => checkbox.checked = false);
            const radioButtons = document.querySelectorAll('input[name="interest"]');
            radioButtons.forEach(radio => radio.checked = false);
        });
    </script>
</body>
</html>
